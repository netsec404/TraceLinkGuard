<!-- web_ui.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Trace Link Gaurd</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    #clear { background: rgba(54, 124, 230, 0.904); color: white; }
    #clear:hover { filter: brightness(1.1); }
    :root {
      --bg: #0f172a; --panel: #111827; --text: #e5e7eb; --muted: #9ca3af;
      --green: #10b981; --amber: #f59e0b; --red: #ef4444; --blue: #3b82f6;
      --card: #1f2937; --border: #374151;
    }
    body { margin: 0; font-family: system-ui, Segoe UI, Roboto, Arial; background: var(--bg); color: var(--text); }
    .wrap { max-width: 1000px; margin: 40px auto; padding: 0 16px; }
    h1 { margin: 0 0 16px; font-size: 24px; }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
    input[type="text"] { width: 100%; padding: 12px 14px; border-radius: 8px; border: 1px solid var(--border);
      background: var(--panel); color: var(--text); outline: none; }
    button { padding: 12px 16px; border-radius: 8px; border: 0; background: var(--blue); color: white; cursor: pointer; }
    button:hover { filter: brightness(1.1); }
    .banner { margin-top: 12px; padding: 12px; border-radius: 8px; background: #1e293b; border: 1px solid var(--border); }
    .grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; margin-top: 16px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
    .label { font-size: 12px; color: var(--muted); }
    .value { margin-top: 6px; font-size: 14px; word-break: break-word; }
    .verdict { display: inline-flex; align-items: center; gap: 10px; padding: 12px 14px; border-radius: 999px; font-weight: 600; margin-top: 16px; }
    .allow { background: rgba(16, 185, 129, .15); color: var(--green); border: 1px solid rgba(16, 185, 129, .35); }
    .warn { background: rgba(245, 158, 11, .15); color: var(--amber); border: 1px solid rgba(245, 158, 11, .35); }
    .block { background: rgba(239, 68, 68, .15); color: var(--red); border: 1px solid rgba(239, 68, 68, .35); }
    .section-title { margin-top: 24px; font-size: 16px; font-weight: 600; }
    pre { white-space: pre-wrap; word-wrap: break-word; background: #0b1220; border: 1px solid var(--border); padding: 12px; border-radius: 8px; }
    .small { font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Trace Link Gaurd</h1>

<div class="row">
  <input id="url" type="text" placeholder="Paste URL (e.g., https://www.example.com)" />
  <button id="go">Analyze</button>
  <button id="clear">Clear</button> <!-- fixed: lowercase id -->
</div>

  <div id="banner" class="banner" style="display:none;"></div>

  <div id="result" style="display:none;">
    <div id="verdict" class="verdict"></div>

    <div class="grid">
      <div class="card">
        <div class="label">Host</div>
        <div class="value" id="host"></div>
      </div>
      <div class="card">
        <div class="label">Registrar</div>
        <div class="value" id="registrar">Unavailable</div>
      </div>
      <div class="card">
        <div class="label">Domain age</div>
        <div class="value" id="domain_age">Unavailable days</div>
      </div>
      <div class="card">
        <div class="label">Resolved IP</div>
        <div class="value" id="resolved_ip"></div>
      </div>
      <div class="card">
        <div class="label">All IPs</div>
        <div class="value" id="all_ips"></div>
      </div>
      <div class="card">
        <div class="label">Location</div>
        <div class="value" id="location"></div>
      </div>
      <div class="card">
        <div class="label">Organization</div>
        <div class="value" id="org"></div>
      </div>
      <div class="card">
        <div class="label">Content type</div>
        <div class="value" id="content_type"></div>
      </div>
      <div class="card">
        <div class="label">Content length</div>
        <div class="value" id="content_length"></div>
      </div>
    </div>

    <div class="section-title">Reasons</div>
    <pre id="reasons"></pre>

    <div class="section-title">Redirects</div>
    <pre id="redirects"></pre>

    <div class="section-title">Traceroute</div>
    <pre id="traceroute"></pre>

    <div class="small">Tip: Paste raw email headers into the headers analyzer route for device/OS insight.</div>
  </div>
</div>

<script>
const API = "http://localhost:9000";

function normalize(input) {
  input = input.trim();
  if (!input) return input;
  // If missing scheme, default to https
  if (!/^https?:\/\//i.test(input)) {
    input = "https://" + input;
  }
  return input;
}

function verdictClass(v, risk) {
  if (v === "block" || risk === "high") return "verdict block";
  if (risk === "medium") return "verdict warn";
  return "verdict allow";
}

function verdictText(v, risk) {
  if (v === "block") return "Block: Risk = High";
  if (risk === "medium") return "Allow: Risk = Medium";
  return "Allow: Risk = Low";
}

function showBanner(msg) {
  const el = document.getElementById("banner");
  el.textContent = msg;
  el.style.display = "block";
}

function hideBanner() {
  const el = document.getElementById("banner");
  el.style.display = "none";
}
function clearAll() {
  document.getElementById("url").value = "";
  document.getElementById("result").style.display = "none";
  document.getElementById("banner").style.display = "none";
}

async function analyze() {
  hideBanner();

  const u = normalize(document.getElementById("url").value);
  if (!u) {
    showBanner("Please enter a valid URL");
    return;
  }

  try {
    const res = await fetch(`${API}/analyze?url=${encodeURIComponent(u)}`);
    if (!res.ok) {
      const txt = await res.text();
      showBanner(`Analyze error: ${txt}`);
      return;
    }
    const data = await res.json();
    if (data.error) {
      showBanner(data.error);
      return;
    }

    // Verdict badge
    const vEl = document.getElementById("verdict");
    vEl.className = verdictClass(data.verdict, data.risk);
    vEl.textContent = verdictText(data.verdict, data.risk);

    // Details
    document.getElementById("result").style.display = "block";
    document.getElementById("host").textContent = data.canonical_host || "-";
    document.getElementById("resolved_ip").textContent = data.resolved_ip || "-";
    document.getElementById("all_ips").textContent = (data.all_ips && data.all_ips.length) ? data.all_ips.join(", ") : "-";

    const loc = data.ip_geolocation || {};
    document.getElementById("location").textContent = `${loc.city || "-"}, ${loc.country || "-"}`;
    document.getElementById("org").textContent = loc.org || "-";
    const whois = data.whois || {};
    document.getElementById("registrar").textContent = whois.registrar || "Unavailable";
    document.getElementById("domain_age").textContent = (whois.domain_age_days !== undefined && whois.domain_age_days !== "Unavailable")
      ? `${whois.domain_age_days} days`
      : "Unavailable days";
    document.getElementById("content_type").textContent = data.content_type || "-";
    document.getElementById("content_length").textContent = data.content_length || "-";

    // Reasons, redirects, traceroute
    document.getElementById("reasons").textContent = (data.reasons || []).join("\n") || "-";
    document.getElementById("redirects").textContent = (data.redirects || [])
      .map(r => `${r.status} ${r.url}${r.location ? " â†’ " + r.location : ""}`).join("\n") || "-";
    document.getElementById("traceroute").textContent = (data.traceroute || []).join("\n") || "-";

  } catch (err) {
    showBanner(`NetworkError: ${err}`);
  }
}

document.getElementById("go").addEventListener("click", analyze);
document.getElementById("url").addEventListener("keydown", e => { if (e.key === "Enter") analyze(); });
document.getElementById("clear").addEventListener("click", clearAll);
</script>
</body>
</html>